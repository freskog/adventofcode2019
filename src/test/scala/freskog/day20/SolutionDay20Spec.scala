package freskog.day20

import zio.test.Assertion.{contains, equalTo, hasSize, isRight, isSome}
import zio.test._

object SolutionDay20Spec extends DefaultRunnableSpec ({

  val i1 =
  """         A
    |         A
    |  #######.#########
    |  #######.........#
    |  #######.#######.#
    |  #######.#######.#
    |  #######.#######.#
    |  #####  B    ###.#
    |BC...##  C    ###.#
    |  ##.##       ###.#
    |  ##...DE  F  ###.#
    |  #####    G  ###.#
    |  #########.#####.#
    |DE..#######...###.#
    |  #.#########.###.#
    |FG..#########.....#
    |  ###########.#####
    |             Z
    |             Z
    |""".stripMargin

  val full =
    """                                     C           T     N Z       D   C       X P
      |                                     Y           L     Z Z       M   V       Z P
      |  ###################################.###########.#####.#.#######.###.#######.#.#######################################
      |  #.#.#.#.#.#...#.......#...#.........#...#...........#.#.....#.....#.......#...............#.............#...#.......#
      |  #.#.#.#.#.###.#.###.###.###.###.###.#.#.###.#.###.###.#.#.#####.#.#.###.#########.###.#####.#.###.###.#####.#####.###
      |  #.....#...#.....#.#.........#...#.....#...#.#.#...#.#...#.#.....#.#.#.#.....#.......#...#...#...#...#.#.....#...#.#.#
      |  #####.###.#######.###.#.#.###.###.#.###.#########.#.#.###.#.#########.###.#####.#####.#####.#########.###.###.###.#.#
      |  #...........#.......#.#.#.#...#...#.#.......#.......#.#...#.......#.#.........#.#.#.....#.#.......#.#.#.......#.....#
      |  #####.#.#.#######.#.###.#####.#####.#####.#######.###.###.###.#####.#.###.#####.#.###.###.#.#.#####.#####.#.###.#.###
      |  #.....#.#.....#.#.#.#.#...#...#.....#.....#.#.#.....#...#...#...#.......#...#.#...#.#.......#...#.#...#...#.#...#...#
      |  #.#.#.#.#####.#.###.#.###########.#######.#.#.###.#.#####.#####.###.#.###.#.#.#.###.#.###.#######.#.#####.#####.#####
      |  #.#.#.#.#.#.#.........#...#...#...#.#.#...#...#.#.#...#...#...#...#.#...#.#.#.#...#.....#.....#.#.....#...#.#...#...#
      |  #.#.#.#.#.#.#.###.#.#.###.###.#####.#.#.###.#.###.#.###.#.###.###.#.#########.#.#######.#.#.###.#.#.#####.#.#.#.###.#
      |  #.#.#.#.#.....#.#.#.#.#.....#.......#.#.#...#.....#...#.#.#.....#.#.....#...#.........#.#.#...#...#.#...#.....#.#...#
      |  #######.#######.#####.###.###.#####.#.#.###.###.#.#######.###.#.#.#.#####.###.#######.###.#####.#.###.###.#.#.###.#.#
      |  #.#...#.#.#.#...#...#...#.#.#.#...#.#...#.....#.#.#...#...#.#.#...#...#...#.......#.....#.......#...#...#.#.#.#.#.#.#
      |  #.###.###.#.#.#.#.###.###.#.#####.#.#.#.###.#######.#####.#.#.#.#.#.###.###.#############.#.###.#######.#.#####.###.#
      |  #.#.....#.....#.................#.....#.#.#...#.....#.#.#.#...#.#.#.....#.#.#...#.....#...#.#.#.#...#.......#...#...#
      |  #.###.#.###.#####.#.#.#.#####.###.#.#.###.#.#.###.#.#.#.#.#.#.#.#####.###.#.#.###.###########.#####.###.#######.###.#
      |  #...#.#.#...#.....#.#.#.#...#.#...#.#.#.....#...#.#.....#.#.#.#...#...#...#...#.#.#.#.....#...#.....#.....#.#.....#.#
      |  ###.#.###.#.###.#.#########.#.###.#.###.###.#.#####.###.#.#.#######.#####.#.###.#.#.#.#######.#####.###.###.###.###.#
      |  #...#.#.#.#.#...#.#...#.........#.#.#...#.#.#.#.......#.#.#.....#...#.....#...........#.#.#.#.#.#.....#...#.#.....#.#
      |  ###.#.#.#######.#####.#######.#####.#####.#.#########.#.#.###.#####.#.###.#.#.#.###.###.#.#.#.#.#.#.###.###.#.#####.#
      |  #.........#...#...#.#.#.............#...#.......#.....#...#.......#.#.#...#.#.#...#.....#...#.#...#...#.#...#.#.#.#.#
      |  #####.#.###.#######.#.#####.#######.#.###.#.#.###.#.#######.#######.#.#.###.#.#.#########.###.###.#####.#.###.#.#.#.#
      |  #.....#...#.....#.#...#.....#.#.#.....#...#.#.#.#.#.......#...#...#.#.#.#.#.#.#...#...#...#.........#...#.#...#.#.#.#
      |  #####.#.#####.###.#.#########.#.###.#####.#.###.#########.#.###.###.#.#.#.#.#########.###.###.#########.#.###.#.#.#.#
      |  #...#.#.#.#.......#.#.#.....#.#.........#.#...#...#.......#.......#.#.#...#.#.#...#...#...........#...#.#.....#.....#
      |  ###.###.#.###.###.#.#.#.###.#.###.#.#######.###.###.#######.###.###.#.###.#.#.###.#.#.#######.#####.###.#.#.###.#.###
      |  #.......#.#.#...#.#...#.#...#.#...#.#.....#.....#.#.....#.#...#.#.#.#.#.#.#...#...#.#.....#.....#.#.#...#.#...#.#...#
      |  #####.#.#.#.#####.#.#######.#.#####.#.#####.#.###.###.#.#.#.#####.#.#.#.#.#.###.#####.#######.###.#.#.#####.###.#####
      |  #...#.#.......#.......#...................#.#...#.....#.#.........#...#...#...........#.#.......#.#...#.#.....#...#.#
      |  ###.###.#######.###.#################.#####.###########.#######.#######.#####.#.#######.#.#####.#.###.#.###.###.#.#.#
      |  #.#...#.#.#...#.#...#.#.....#.#      G     U           U       G       Y     P J      #...#.....#.#.#.#...#.#.#.#.#.#
      |  #.###.#.#.#.#.#####.#.###.###.#      Y     M           C       C       O     Y V      ###.#####.#.#.#.###.#.#.#.###.#
      |UM....#...#.#.#.#...#.#.#.......#                                                       #.#.#.#...#.........#.........#
      |  #.#####.#.#.#####.#.#.#.#.#.###                                                       #.###.#.#.#.#.#.###.#.###.#.###
      |  #.............#...#.#.#.#.#.#..LM                                                     #.#...#.#.#.#.#...#.....#.#.#.#
      |  #.###.#####.#####.#.#.#.#.###.#                                                       #.#.###.#.#.###.###.#.###.###.#
      |  #...#.#...#.............#.....#                                                     TL..#.....#.....#.#...#.#...#.#.#
      |  #########.###########.###.#####                                                       #.#####.#.###########.###.#.#.#
      |  #...#...............#.#.#.#...#                                                       #.......#...#.......#.#........PY
      |  #.###.#.###.#.###.#####.###.###                                                       #############.#.#.#############
      |YO......#.#...#...#.#.......#...#                                                     WH..#.#.#.#.#.#.#.#...#.#.......#
      |  #.#.#.#.#.#.#####.#.#.#####.###                                                       #.#.#.#.#.#.#####.#.#.###.#.###
      |  #.#.#.#.#.#.#.......#.#.#.#.#..AM                                                     #.#.#...#.#.#.....#.#.#...#....KK
      |  #######.###.#####.###.#.#.#.#.#                                                       #.#.#.###.#.#####.#.#.#.###.###
      |  #...#...#...#.#.....#.........#                                                       #.......#.....#.#.#.....#...#.#
      |  #.###########.#############.###                                                       #####.#.###.#.#.#.###.###.#.#.#
      |  #...#.#...#.#...#.........#.#..XI                                                     #...#.#.....#.....#.....#.#.#.#
      |  #.###.#.###.###.#.###.#######.#                                                       ###.###.#####################.#
      |  #.#...#.#...#.#.#.#.....#.....#                                                       #...#.#.#...#.#.........#.....#
      |  #.#.###.#.#.#.#.#.#.#####.#####                                                       ###.#.###.###.#.#.#.###.#.###.#
      |AW..........#.......#...........#                                                       #.#.....#...#...#.#.#.....#...#
      |  ###############################                                                       #.#.###.#.#.#.#.###.###.###.###
      |  #.......#.....................#                                                     CV..#...#...#...#...#...#.#.....#
      |  ###.###.#.###.###.#.#.###.###.#                                                       #.###.###.#.#.###.###########.#
      |  #...#...#...#.#...#.#.#...#.#..HB                                                     #.....#...#.#.#.#.#.#.....#.#..CQ
      |  ###.#.#####.#.#####.#####.#.#.#                                                       #.###.###.#####.###.###.###.###
      |GL..#.#.....#.#.#...#.#...#...#.#                                                       #...#...#.#.#...#...#.#.......#
      |  #.#.#.#.#.#.#####.###.#########                                                       ###########.###.#.#.#.#.#####.#
      |  #...#.#.#.....#.#.......#.#...#                                                       #...#.#.........#.#...#.....#.#
      |  ###############.#.#######.#.###                                                       ###.#.#####.###.#####.#####.#.#
      |PN....#.................#.....#.#                                                       #.#.....#.#...#.#...........#..JV
      |  #.#.#.###.#.#########.###.#.#.#                                                       #.###.###.#.#.#####.#.#.###.###
      |  #.#.#...#.#.#.........#...#.#..NZ                                                   CY............#.......#.#.#.#.#.#
      |  ###.###.###.#.###.#######.#.#.#                                                       #######.#######.#########.###.#
      |  #.....#...#.#.#.....#...#.#.#.#                                                     DM......#.#...#...#.#...#...#....AM
      |  #.#.###.###########.#.#.#.#.#.#                                                       ###.#####.#.#####.#.###.#.#.#.#
      |  #.#...........#.......#...#...#                                                       #.#.#...#.#...#.#.......#.#.#.#
      |  ###############.###########.#.#                                                       #.#.###.#.#.###.###.#.###.#.###
      |  #.#.....#.....#.#.......#.#.#.#                                                       #...#.....#...#...#.#.#...#...#
      |  #.#.#.###.#######.###.###.###.#                                                       #.#.###.###.#.###.#.###.#####.#
      |  #...#.#.#...#.#.#...#.......#.#                                                       #.#.......#.#.........#.......#
      |  #.###.#.#.###.#.###.#####.#####                                                       #######.#.#.###.#.#####.#.###.#
      |YF..#.#.........#...#...#...#....PN                                                   XZ......#.#.#.#.#.#.#.....#.#.#.#
      |  #.#.#######.###.#.###.###.#.###                                                       #####.#####.#.#.###########.###
      |  #.#.#.#.#.......#.......#.....#                                                       #.........#.#.#.#.#...........#
      |  ###.#.#.###.#######.#.#########                                                       #.###########.###.#.###.#######
      |  #.......#...#.#...#.#...#.#....KY                                                     #.......#.#.....#...#.#.......#
      |  #####.#.#####.#.#########.###.#                                                       #.#.###.#.###.###.###.#.#######
      |YA..#...#.....#.#...#...#.#.....#                                                       #.#...#.............#..........KY
      |  #.###.###.###.#.#.#.#.#.#.#####                                                       #.#########.#.#.#####.#.#.#.#.#
      |  #.......#.......#...#.........#                                                       #...#.......#.#.#.#...#.#.#.#.#
      |  #.#######.###.###.#.#.#.#.###.#      A       K   C       G       Y     Y     P        #.#######.#.###.#.#######.#####
      |  #.#.......#...#...#.#.#.#...#.#      W       K   Q       L       A     F     P        #...#.....#...#...#.#.#.......#
      |  #.###.#####.###.#.#.#.#.#.###.#######.#######.###.#######.#######.#####.#####.#################.#.###.###.#.###.#.###
      |  #.#...#...#.#...#.#.#.#.#...#.#.......#.........#.#.#.#.....#.#.#.....#.#.......#.....#...#.#...#...#.......#...#.#.#
      |  #####.###.#######.#####.#.#######.#.#####.#####.#.#.#.#.#####.#.###.###.###.###.#.#.###.###.###.###.#.###.#####.###.#
      |  #.........#...........#.#.......#.#.....#...#.#.#...#.#...........#.#.....#.#.....#.........#.....#.#.#.....#.#.#...#
      |  #####.#######.#####.###.#.###.#####.#.#####.#.#####.#.###.#.#######.#.#.#####.###.#.###.###.#########.###.###.#.###.#
      |  #.......#.....#...#...#.#...#.#...#.#.....#.....#.#.....#.#...#.....#.#.#.#.#.#.#.#...#.#...#...#.......#.....#.#.#.#
      |  #.###.###.#.#.###.#.#####.#.###.#####.#.###.#.#.#.#.#.#####.#####.###.###.#.###.###.#.#####.###.#.###.###.###.#.#.#.#
      |  #...#...#.#.#.#.....#.#...#.#.#...#...#...#.#.#.#...#...#.#.....#...#.#.#...#.......#...#.....#...#...#...#...#.....#
      |  #.#########.#####.#.#.#.#.###.#.#######.#####.#######.###.#.#.###.###.#.###.#######.#.###.#.#.###.###.#####.#######.#
      |  #.....#.......#...#...#.#.#...#...........#.......#.....#...#...#...#.......#.#...#.#.#...#.#.#.#.#.#...#...#.......#
      |  ###.#####.#.###.#.#####.#.###.###.#.#.#.#.###.#.#####.#####.#####.#####.###.#.###.#.#.###.#.###.#.#.#.#.###.###.###.#
      |  #...#.#...#...#.#...#...#.#.#.....#.#.#.#.#...#.#.....#...#.#.......#...#.#...#.#.#.#.#.#.#.....#.#...#.#.#...#...#.#
      |  #.###.###.#.#####.#.#######.#.###.#####.#####.#.#####.###.#.###.###.###.#.#.###.#.#.###.###.#######.#.###.#########.#
      |  #.#.......#...#.#.#.#...#...#.#.#.#.......#...#.#.#.....#.....#...#...#.#.......#...#.#...#.....#.#.#...........#.#.#
      |  #.#.###.#.#####.#.#.###.###.###.#.#.#.#.###.#####.###.###.#.#######.#.#####.#####.#.#.#.#########.###.###.#.#####.###
      |  #.#.#...#.#...#.#.#...#.......#.#.#.#.#...#.....#...#.#.#.#.#.#.#...#...#.....#.#.#.......#.#...#.......#.#.........#
      |  #####.#######.#.#######.###.###.#######.###.#.#####.#.#.###.#.#.###.#.#.###.###.###.#######.#.#####.###.#####.###.#.#
      |  #.......#.........#...#.#.....#...#.#.....#.#.#.......#.#...#.......#.#.#...#...#...............#...#...#.....#...#.#
      |  #####.#####.#.#.#.###.#####.#.#.###.###.#####.#.#######.#.#.#.###.#######.#.###.###.###.#######.#########.###.###.#.#
      |  #.#...#.....#.#.#...#.#.#...#.............#...#.#.......#.#.#...#.#.....#.#.#.....#...#.....#.........#.....#...#.#.#
      |  #.###.###.#########.#.#.#####.###.#.#.###.###.#.#.###.#.#.#####.###.#######.#.###.#.###.#.#.###.#####.###.#.#####.#.#
      |  #.......#.#.................#.#.#.#.#.#...#...#.#.#.#.#.#...#.#.....#.#.....#.#.#.#...#.#.#...#...#...#...#.....#.#.#
      |  ###.#.###.###########.###.#####.#.#########.###.#.#.#.###.###.#####.#.#.###.#.#.#.#.#######.#.#############.#.#######
      |  #.#.#...#.#.#.#...#.....#.#.............#.....#...#.#.#.....#.....#...#.#.#.#.#.#.......#.#.#.#.#.....#...#.#.......#
      |  #.#########.#.#.#########.#.#####.#######.#.#.#######.#####.#.###.#.###.#.#.#.#.#.###.###.#####.###.###.#####.#.#.###
      |  #.#.......#.....#.#.............#.....#...#.#.#.#...#.#.#...#...#...#...#.#.#.#.#...#.....#.#.............#.#.#.#...#
      |  #.#######.#####.#.###.#####.#####.###########.#.#.###.#.###.###.#########.#.#.###.#.#.#####.#.#.#.###.#.###.###.#.#.#
      |  #.#.......#.#.........#.#...#...#.#.#.#.....#.#.......#.....#.#...#.#.......#...#.#.#.........#.#...#.#.......#.#.#.#
      |  #.#####.###.###.#.#.###.#.#####.#.#.#.###.###.#.#.###.#.#.#.#.#.###.###.###.#.#####.#.#.#.#.#.#####.#############.###
      |  #...............#.#.#.....#.........#.........#.#.#...#.#.#.#.........#...#.#.....#.#.#.#.#.#.#.................#...#
      |  ###################################.#####.#####.###########.###.###.#####.###.#######################################
      |                                     G     H     W           U   A   X     L   G
      |                                     Y     B     H           C   A   I     M   C""".stripMargin

  import SolutionDay20._

  def startToFinish(input:String):Int = {
    val world = parseWorld(parseTiles(input))
    val start = findStart(world)
    val end = findGoal(world)
    distance(start, end, world.edges)
  }


  suite("SolutionDay20")(
    suite("Part 1")(
      test("righmost column is 18")(assert(parseTiles(i1).keys.maxBy(_.x).x,equalTo(18))),
      test("lowest row is 18")(assert(parseTiles(i1).keys.maxBy(_.x).x,equalTo(18))),
      test("warp letter at 9,0")(assert(parseTiles(i1)(Pos(9,0)),equalTo(Letter('A')))),
      test("warp letter at 9,1")(assert(parseTiles(i1)(Pos(9,1)),equalTo(Letter('A')))),
      test("parse warp at 9,2")(assert(parseWarp(Pos(9,2),parseTiles(i1)),isSome(equalTo("AA")))),
      test("parse warp at 2,8")(assert(parseWarp(Pos(2,8),parseTiles(i1)),isSome(equalTo("BC")))),
      test("parse warp at 9,6")(assert(parseWarp(Pos(9,6),parseTiles(i1)),isSome(equalTo("BC")))),
      test("6 warps in i1")(assert(parseWorld(parseTiles(i1)).warps, hasSize(equalTo(8)))),
      test("warp (9,6)->(2,8)")(assert(parseWorld(parseTiles(i1)).edges(Pos(9,6)),contains(Pos(2,8)))),
      test("warp (2,8)->(9,6)")(assert(parseWorld(parseTiles(i1)).edges(Pos(2,8)),contains(Pos(9,6)))),
      test("start is 9,2")(assert(findStart(parseWorld(parseTiles(i1))),equalTo(Pos(9,2)))),
      test("start is 13,16")(assert(findGoal(parseWorld(parseTiles(i1))),equalTo(Pos(13,16)))),
      test("test distance is 23")(assert(startToFinish(i1),equalTo(23))),
      test("full distance is 556")(assert(startToFinish(full),equalTo(556))),
    )
  )

})
