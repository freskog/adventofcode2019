package freskog.day20

import zio.test.Assertion.{ contains, equalTo, hasSameElements, hasSize, isRight, isSome }
import zio.test._

object SolutionDay20Spec
    extends DefaultRunnableSpec({

      val i1 =
        """         A
          |         A
          |  #######.#########
          |  #######.........#
          |  #######.#######.#
          |  #######.#######.#
          |  #######.#######.#
          |  #####  B    ###.#
          |BC...##  C    ###.#
          |  ##.##       ###.#
          |  ##...DE  F  ###.#
          |  #####    G  ###.#
          |  #########.#####.#
          |DE..#######...###.#
          |  #.#########.###.#
          |FG..#########.....#
          |  ###########.#####
          |             Z
          |             Z
          |""".stripMargin

      val full =
        """                                     C           T     N Z       D   C       X P
          |                                     Y           L     Z Z       M   V       Z P
          |  ###################################.###########.#####.#.#######.###.#######.#.#######################################
          |  #.#.#.#.#.#...#.......#...#.........#...#...........#.#.....#.....#.......#...............#.............#...#.......#
          |  #.#.#.#.#.###.#.###.###.###.###.###.#.#.###.#.###.###.#.#.#####.#.#.###.#########.###.#####.#.###.###.#####.#####.###
          |  #.....#...#.....#.#.........#...#.....#...#.#.#...#.#...#.#.....#.#.#.#.....#.......#...#...#...#...#.#.....#...#.#.#
          |  #####.###.#######.###.#.#.###.###.#.###.#########.#.#.###.#.#########.###.#####.#####.#####.#########.###.###.###.#.#
          |  #...........#.......#.#.#.#...#...#.#.......#.......#.#...#.......#.#.........#.#.#.....#.#.......#.#.#.......#.....#
          |  #####.#.#.#######.#.###.#####.#####.#####.#######.###.###.###.#####.#.###.#####.#.###.###.#.#.#####.#####.#.###.#.###
          |  #.....#.#.....#.#.#.#.#...#...#.....#.....#.#.#.....#...#...#...#.......#...#.#...#.#.......#...#.#...#...#.#...#...#
          |  #.#.#.#.#####.#.###.#.###########.#######.#.#.###.#.#####.#####.###.#.###.#.#.#.###.#.###.#######.#.#####.#####.#####
          |  #.#.#.#.#.#.#.........#...#...#...#.#.#...#...#.#.#...#...#...#...#.#...#.#.#.#...#.....#.....#.#.....#...#.#...#...#
          |  #.#.#.#.#.#.#.###.#.#.###.###.#####.#.#.###.#.###.#.###.#.###.###.#.#########.#.#######.#.#.###.#.#.#####.#.#.#.###.#
          |  #.#.#.#.#.....#.#.#.#.#.....#.......#.#.#...#.....#...#.#.#.....#.#.....#...#.........#.#.#...#...#.#...#.....#.#...#
          |  #######.#######.#####.###.###.#####.#.#.###.###.#.#######.###.#.#.#.#####.###.#######.###.#####.#.###.###.#.#.###.#.#
          |  #.#...#.#.#.#...#...#...#.#.#.#...#.#...#.....#.#.#...#...#.#.#...#...#...#.......#.....#.......#...#...#.#.#.#.#.#.#
          |  #.###.###.#.#.#.#.###.###.#.#####.#.#.#.###.#######.#####.#.#.#.#.#.###.###.#############.#.###.#######.#.#####.###.#
          |  #.#.....#.....#.................#.....#.#.#...#.....#.#.#.#...#.#.#.....#.#.#...#.....#...#.#.#.#...#.......#...#...#
          |  #.###.#.###.#####.#.#.#.#####.###.#.#.###.#.#.###.#.#.#.#.#.#.#.#####.###.#.#.###.###########.#####.###.#######.###.#
          |  #...#.#.#...#.....#.#.#.#...#.#...#.#.#.....#...#.#.....#.#.#.#...#...#...#...#.#.#.#.....#...#.....#.....#.#.....#.#
          |  ###.#.###.#.###.#.#########.#.###.#.###.###.#.#####.###.#.#.#######.#####.#.###.#.#.#.#######.#####.###.###.###.###.#
          |  #...#.#.#.#.#...#.#...#.........#.#.#...#.#.#.#.......#.#.#.....#...#.....#...........#.#.#.#.#.#.....#...#.#.....#.#
          |  ###.#.#.#######.#####.#######.#####.#####.#.#########.#.#.###.#####.#.###.#.#.#.###.###.#.#.#.#.#.#.###.###.#.#####.#
          |  #.........#...#...#.#.#.............#...#.......#.....#...#.......#.#.#...#.#.#...#.....#...#.#...#...#.#...#.#.#.#.#
          |  #####.#.###.#######.#.#####.#######.#.###.#.#.###.#.#######.#######.#.#.###.#.#.#########.###.###.#####.#.###.#.#.#.#
          |  #.....#...#.....#.#...#.....#.#.#.....#...#.#.#.#.#.......#...#...#.#.#.#.#.#.#...#...#...#.........#...#.#...#.#.#.#
          |  #####.#.#####.###.#.#########.#.###.#####.#.###.#########.#.###.###.#.#.#.#.#########.###.###.#########.#.###.#.#.#.#
          |  #...#.#.#.#.......#.#.#.....#.#.........#.#...#...#.......#.......#.#.#...#.#.#...#...#...........#...#.#.....#.....#
          |  ###.###.#.###.###.#.#.#.###.#.###.#.#######.###.###.#######.###.###.#.###.#.#.###.#.#.#######.#####.###.#.#.###.#.###
          |  #.......#.#.#...#.#...#.#...#.#...#.#.....#.....#.#.....#.#...#.#.#.#.#.#.#...#...#.#.....#.....#.#.#...#.#...#.#...#
          |  #####.#.#.#.#####.#.#######.#.#####.#.#####.#.###.###.#.#.#.#####.#.#.#.#.#.###.#####.#######.###.#.#.#####.###.#####
          |  #...#.#.......#.......#...................#.#...#.....#.#.........#...#...#...........#.#.......#.#...#.#.....#...#.#
          |  ###.###.#######.###.#################.#####.###########.#######.#######.#####.#.#######.#.#####.#.###.#.###.###.#.#.#
          |  #.#...#.#.#...#.#...#.#.....#.#      G     U           U       G       Y     P J      #...#.....#.#.#.#...#.#.#.#.#.#
          |  #.###.#.#.#.#.#####.#.###.###.#      Y     M           C       C       O     Y V      ###.#####.#.#.#.###.#.#.#.###.#
          |UM....#...#.#.#.#...#.#.#.......#                                                       #.#.#.#...#.........#.........#
          |  #.#####.#.#.#####.#.#.#.#.#.###                                                       #.###.#.#.#.#.#.###.#.###.#.###
          |  #.............#...#.#.#.#.#.#..LM                                                     #.#...#.#.#.#.#...#.....#.#.#.#
          |  #.###.#####.#####.#.#.#.#.###.#                                                       #.#.###.#.#.###.###.#.###.###.#
          |  #...#.#...#.............#.....#                                                     TL..#.....#.....#.#...#.#...#.#.#
          |  #########.###########.###.#####                                                       #.#####.#.###########.###.#.#.#
          |  #...#...............#.#.#.#...#                                                       #.......#...#.......#.#........PY
          |  #.###.#.###.#.###.#####.###.###                                                       #############.#.#.#############
          |YO......#.#...#...#.#.......#...#                                                     WH..#.#.#.#.#.#.#.#...#.#.......#
          |  #.#.#.#.#.#.#####.#.#.#####.###                                                       #.#.#.#.#.#.#####.#.#.###.#.###
          |  #.#.#.#.#.#.#.......#.#.#.#.#..AM                                                     #.#.#...#.#.#.....#.#.#...#....KK
          |  #######.###.#####.###.#.#.#.#.#                                                       #.#.#.###.#.#####.#.#.#.###.###
          |  #...#...#...#.#.....#.........#                                                       #.......#.....#.#.#.....#...#.#
          |  #.###########.#############.###                                                       #####.#.###.#.#.#.###.###.#.#.#
          |  #...#.#...#.#...#.........#.#..XI                                                     #...#.#.....#.....#.....#.#.#.#
          |  #.###.#.###.###.#.###.#######.#                                                       ###.###.#####################.#
          |  #.#...#.#...#.#.#.#.....#.....#                                                       #...#.#.#...#.#.........#.....#
          |  #.#.###.#.#.#.#.#.#.#####.#####                                                       ###.#.###.###.#.#.#.###.#.###.#
          |AW..........#.......#...........#                                                       #.#.....#...#...#.#.#.....#...#
          |  ###############################                                                       #.#.###.#.#.#.#.###.###.###.###
          |  #.......#.....................#                                                     CV..#...#...#...#...#...#.#.....#
          |  ###.###.#.###.###.#.#.###.###.#                                                       #.###.###.#.#.###.###########.#
          |  #...#...#...#.#...#.#.#...#.#..HB                                                     #.....#...#.#.#.#.#.#.....#.#..CQ
          |  ###.#.#####.#.#####.#####.#.#.#                                                       #.###.###.#####.###.###.###.###
          |GL..#.#.....#.#.#...#.#...#...#.#                                                       #...#...#.#.#...#...#.#.......#
          |  #.#.#.#.#.#.#####.###.#########                                                       ###########.###.#.#.#.#.#####.#
          |  #...#.#.#.....#.#.......#.#...#                                                       #...#.#.........#.#...#.....#.#
          |  ###############.#.#######.#.###                                                       ###.#.#####.###.#####.#####.#.#
          |PN....#.................#.....#.#                                                       #.#.....#.#...#.#...........#..JV
          |  #.#.#.###.#.#########.###.#.#.#                                                       #.###.###.#.#.#####.#.#.###.###
          |  #.#.#...#.#.#.........#...#.#..NZ                                                   CY............#.......#.#.#.#.#.#
          |  ###.###.###.#.###.#######.#.#.#                                                       #######.#######.#########.###.#
          |  #.....#...#.#.#.....#...#.#.#.#                                                     DM......#.#...#...#.#...#...#....AM
          |  #.#.###.###########.#.#.#.#.#.#                                                       ###.#####.#.#####.#.###.#.#.#.#
          |  #.#...........#.......#...#...#                                                       #.#.#...#.#...#.#.......#.#.#.#
          |  ###############.###########.#.#                                                       #.#.###.#.#.###.###.#.###.#.###
          |  #.#.....#.....#.#.......#.#.#.#                                                       #...#.....#...#...#.#.#...#...#
          |  #.#.#.###.#######.###.###.###.#                                                       #.#.###.###.#.###.#.###.#####.#
          |  #...#.#.#...#.#.#...#.......#.#                                                       #.#.......#.#.........#.......#
          |  #.###.#.#.###.#.###.#####.#####                                                       #######.#.#.###.#.#####.#.###.#
          |YF..#.#.........#...#...#...#....PN                                                   XZ......#.#.#.#.#.#.#.....#.#.#.#
          |  #.#.#######.###.#.###.###.#.###                                                       #####.#####.#.#.###########.###
          |  #.#.#.#.#.......#.......#.....#                                                       #.........#.#.#.#.#...........#
          |  ###.#.#.###.#######.#.#########                                                       #.###########.###.#.###.#######
          |  #.......#...#.#...#.#...#.#....KY                                                     #.......#.#.....#...#.#.......#
          |  #####.#.#####.#.#########.###.#                                                       #.#.###.#.###.###.###.#.#######
          |YA..#...#.....#.#...#...#.#.....#                                                       #.#...#.............#..........KY
          |  #.###.###.###.#.#.#.#.#.#.#####                                                       #.#########.#.#.#####.#.#.#.#.#
          |  #.......#.......#...#.........#                                                       #...#.......#.#.#.#...#.#.#.#.#
          |  #.#######.###.###.#.#.#.#.###.#      A       K   C       G       Y     Y     P        #.#######.#.###.#.#######.#####
          |  #.#.......#...#...#.#.#.#...#.#      W       K   Q       L       A     F     P        #...#.....#...#...#.#.#.......#
          |  #.###.#####.###.#.#.#.#.#.###.#######.#######.###.#######.#######.#####.#####.#################.#.###.###.#.###.#.###
          |  #.#...#...#.#...#.#.#.#.#...#.#.......#.........#.#.#.#.....#.#.#.....#.#.......#.....#...#.#...#...#.......#...#.#.#
          |  #####.###.#######.#####.#.#######.#.#####.#####.#.#.#.#.#####.#.###.###.###.###.#.#.###.###.###.###.#.###.#####.###.#
          |  #.........#...........#.#.......#.#.....#...#.#.#...#.#...........#.#.....#.#.....#.........#.....#.#.#.....#.#.#...#
          |  #####.#######.#####.###.#.###.#####.#.#####.#.#####.#.###.#.#######.#.#.#####.###.#.###.###.#########.###.###.#.###.#
          |  #.......#.....#...#...#.#...#.#...#.#.....#.....#.#.....#.#...#.....#.#.#.#.#.#.#.#...#.#...#...#.......#.....#.#.#.#
          |  #.###.###.#.#.###.#.#####.#.###.#####.#.###.#.#.#.#.#.#####.#####.###.###.#.###.###.#.#####.###.#.###.###.###.#.#.#.#
          |  #...#...#.#.#.#.....#.#...#.#.#...#...#...#.#.#.#...#...#.#.....#...#.#.#...#.......#...#.....#...#...#...#...#.....#
          |  #.#########.#####.#.#.#.#.###.#.#######.#####.#######.###.#.#.###.###.#.###.#######.#.###.#.#.###.###.#####.#######.#
          |  #.....#.......#...#...#.#.#...#...........#.......#.....#...#...#...#.......#.#...#.#.#...#.#.#.#.#.#...#...#.......#
          |  ###.#####.#.###.#.#####.#.###.###.#.#.#.#.###.#.#####.#####.#####.#####.###.#.###.#.#.###.#.###.#.#.#.#.###.###.###.#
          |  #...#.#...#...#.#...#...#.#.#.....#.#.#.#.#...#.#.....#...#.#.......#...#.#...#.#.#.#.#.#.#.....#.#...#.#.#...#...#.#
          |  #.###.###.#.#####.#.#######.#.###.#####.#####.#.#####.###.#.###.###.###.#.#.###.#.#.###.###.#######.#.###.#########.#
          |  #.#.......#...#.#.#.#...#...#.#.#.#.......#...#.#.#.....#.....#...#...#.#.......#...#.#...#.....#.#.#...........#.#.#
          |  #.#.###.#.#####.#.#.###.###.###.#.#.#.#.###.#####.###.###.#.#######.#.#####.#####.#.#.#.#########.###.###.#.#####.###
          |  #.#.#...#.#...#.#.#...#.......#.#.#.#.#...#.....#...#.#.#.#.#.#.#...#...#.....#.#.#.......#.#...#.......#.#.........#
          |  #####.#######.#.#######.###.###.#######.###.#.#####.#.#.###.#.#.###.#.#.###.###.###.#######.#.#####.###.#####.###.#.#
          |  #.......#.........#...#.#.....#...#.#.....#.#.#.......#.#...#.......#.#.#...#...#...............#...#...#.....#...#.#
          |  #####.#####.#.#.#.###.#####.#.#.###.###.#####.#.#######.#.#.#.###.#######.#.###.###.###.#######.#########.###.###.#.#
          |  #.#...#.....#.#.#...#.#.#...#.............#...#.#.......#.#.#...#.#.....#.#.#.....#...#.....#.........#.....#...#.#.#
          |  #.###.###.#########.#.#.#####.###.#.#.###.###.#.#.###.#.#.#####.###.#######.#.###.#.###.#.#.###.#####.###.#.#####.#.#
          |  #.......#.#.................#.#.#.#.#.#...#...#.#.#.#.#.#...#.#.....#.#.....#.#.#.#...#.#.#...#...#...#...#.....#.#.#
          |  ###.#.###.###########.###.#####.#.#########.###.#.#.#.###.###.#####.#.#.###.#.#.#.#.#######.#.#############.#.#######
          |  #.#.#...#.#.#.#...#.....#.#.............#.....#...#.#.#.....#.....#...#.#.#.#.#.#.......#.#.#.#.#.....#...#.#.......#
          |  #.#########.#.#.#########.#.#####.#######.#.#.#######.#####.#.###.#.###.#.#.#.#.#.###.###.#####.###.###.#####.#.#.###
          |  #.#.......#.....#.#.............#.....#...#.#.#.#...#.#.#...#...#...#...#.#.#.#.#...#.....#.#.............#.#.#.#...#
          |  #.#######.#####.#.###.#####.#####.###########.#.#.###.#.###.###.#########.#.#.###.#.#.#####.#.#.#.###.#.###.###.#.#.#
          |  #.#.......#.#.........#.#...#...#.#.#.#.....#.#.......#.....#.#...#.#.......#...#.#.#.........#.#...#.#.......#.#.#.#
          |  #.#####.###.###.#.#.###.#.#####.#.#.#.###.###.#.#.###.#.#.#.#.#.###.###.###.#.#####.#.#.#.#.#.#####.#############.###
          |  #...............#.#.#.....#.........#.........#.#.#...#.#.#.#.........#...#.#.....#.#.#.#.#.#.#.................#...#
          |  ###################################.#####.#####.###########.###.###.#####.###.#######################################
          |                                     G     H     W           U   A   X     L   G
          |                                     Y     B     H           C   A   I     M   C""".stripMargin

      import SolutionDay20._

      suite("SolutionDay20")(
        suite("Part 1")(
          test("rightmost column is 18")(assert(parseTiles(i1).keys.maxBy(_.x).x, equalTo(18))),
          test("lowest row is 18")(assert(parseTiles(i1).keys.maxBy(_.x).x, equalTo(18))),
          test("warp letter at 9,0")(assert(parseTiles(i1)(Pos(9, 0)), equalTo(Letter('A')))),
          test("warp letter at 9,1")(assert(parseTiles(i1)(Pos(9, 1)), equalTo(Letter('A')))),
          test("parse warp at 9,2")(assert(parseWarp(Pos(9, 2), parseTiles(i1)), isSome(equalTo(Start)))),
          test("parse warp at 2,8")(assert(parseWarp(Pos(2, 8), parseTiles(i1)), isSome(equalTo(Outer("BC"))))),
          test("parse warp at 9,6")(assert(parseWarp(Pos(9, 6), parseTiles(i1)), isSome(equalTo(Inner("BC"))))),
          test("Start reaches")(
            assert[Map[Warp, Int]](
              reachableFrom(Pos(9, 2), 0, Start, Map.empty, Set(Pos(9, 2)), parseWorld(parseTiles(i1))),
              hasSameElements(List((Goal, 26), (Inner("BC"), 4), (Inner("FG"), 30)))
            )
          ),
          test("Inner(FG) reaches")(
            assert[Map[Warp, Int]](
              reachableFrom(Pos(11, 12),
                            0,
                            Inner("FG"),
                            Map(Outer("FG") -> 1),
                            Set(Pos(11, 12)),
                            parseWorld(parseTiles(i1))),
              hasSameElements(List((Outer("FG"), 1), (Goal, 6), (Inner("BC"), 32), (Start, 30)))
            )
          ),
          test("6 warps in i1")(assert(parseWorld(parseTiles(i1)).warps, hasSize(equalTo(8)))),
          test("test distance is 23")(assert(distancePart1(i1), equalTo(23))),
        ),
        suite("Part 2")(
          )
      )

    })
